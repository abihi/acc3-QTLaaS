#cloud-config

apt_update: true
apt_upgrade: true
packages:
 - build-essential
byobu_default: system

ssh_keys:
  rsa_private: |
  -----BEGIN RSA PRIVATE KEY-----
    MIIEogIBAAKCAQEA7cgVgmg8/ioO6LhyPTuSlvQjPAF/oG1K0EF0pem4Ek7Bux7h
    dsATlJi9TXV1RVHz6aW58ed7Gn7DC4snQwI5ZokFiDGmcF6O2RT30IwZXz0vQp/X
    pcf8gQkMQfhM7mkrlOI4zb7ujpzjTOmkq+5ArocaJlW6CoZVkj7VZIQyUmMPqdgG
    YKacAoylPwtzHeVHPT0UKS4NQxgJLQRVPDeIQ6unTIIo+QzjIOYX/o/SH/PXgIpV
    e0WAggf6fw2UknFwmrTxfRdsTMEOBFH/4i8VxWgb5o2XJf4cpkNez9gT0MYp/WVe
    4mLKKc9aKszV1AcWlRztWNqa92pybHN9KsBBZwIDAQABAoIBABFW1NK0nTX/hSTN
    Rm9Wp8LgPK2EgnUFYz46d7Idj/Gt0oy9nL1XFlZwqOU8GngamMnB7wRH1/8/nSN7
    WzqUr/DdLw0Wacep7YrA761Cehsq0AZwt338TlpueXlaDOoZuzbZJEFEmgrGQAD8
    zKhI8GiJq4t+Ftnrn9PRRyhUR4MgWCYzfXzT0rF8Rrtmp9ttHogISeDZgz0VKE6e
    3jDH4Y2AS67QhmF7rdWQAG6ow7RHTFD6WXjo4bsDV0tM5bWr3UIQBrjXUHHP8caU
    QCerH1/elUQRYr/dMLH1Dp//MNtDVeRrfCFvkK0Mhz1wBOKMt08mjFF8Zs0pvbZL
    Uw8h7BECgYEA/Vmq/nb01W+O28O5EXRC1F6Pil95IwtAwWtwFcR3NjPBK7gITKx0
    AXIbyZkjHwHiJns9idZOOl3ZFMuLARzYz3N7Z+lmFC885VK3fLKn4Cd55PKUnQOQ
    t2tnhAz/jO2NrY2sa1o1ANShgDsweid4qzMhxGCPDwgmQkJvGdykbykCgYEA8ES7
    UsiSrbPGwukB9mptC0MFEpenTdJ4OvcjLThSwbr3ONQoKMse8cswnu01So0PrXhv
    UpFJoHZMcz8LLE+juMfOMwTFr0NeJeFUul1eA3pdJWbJazPXDfXSxTlY77+x6myK
    sWFOFO/6klFboYymvyt08qaDIm36fFXjGnttjg8CgYA83shorygQB+epAZN7kBVm
    dPnD40B1nQSH9EpP0I5b5X9qA6Nq2JxepI3sl/CKSKePW1jjvyu4dkfr6SOStt2Y
    qkRiKP+vpdHZv0/6k+olvxZYXbg7KVoh15pdbcoQkBrUMg/VEy1c77mF17LEBqvF
    Zlmclx6IHAslLFUJP6v6UQKBgGxx2UrIFMwp9HBM0wHxjz4iBcwafvz1HicfHNVw
    MooWZTdVKrse0ty3pT5WOlNnz8ewMC7IPL8cJe1uaxCY8YCZTkxgvwkYEwpt5dwo
    ACL5u8kB1693On2mkndKJwYvM5JnY0IkdSWmGyanagBEh46JgsNyvIVxtjkgWty9
    EPmpAoGAVJqXARthVh2gYy12j7yEHyKgNeyLOuE5ikUpnZwH+rXHN/AttIFRg3t1
    Ebmdmr2ubCEUdlbtreMxcKTxf4w1SCCE8YwBmI4wfEbgyaGpgTE5267HrQw86tsK
    fsmUCMGWFNDgGKd2Ct6NJxjnnDr4PpXsQJ1HPCXcVrGOnBSCWiM=
    -----END RSA PRIVATE KEY-----

  rsa_public: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDtyBWCaDz+Kg7ouHI9O5KW9CM8AX+gbUrQQXSl6bgSTsG7HuF2wBOUmL1NdXVFUfPppbnx53safsMLiydDAjlmiQWIMaZwXo7ZFPfQjBlfPS9Cn9elx/yBCQxB+EzuaSuU4jjNvu6OnONM6aSr7kCuhxomVboKhlWSPtVkhDJSYw+p2AZgppwCjKU/C3Md5Uc9PRQpLg1DGAktBFU8N4hDq6dMgij5DOMg5hf+j9If89eAilV7RYCCB/p/DZSScXCatPF9F2xMwQ4EUf/iLxXFaBvmjZcl/hymQ17P2BPQxin9ZV7iYsopz1oqzNXUBxaVHO1Y2pr3anJsc30qwEFn ubuntu@acc3-flask

ssh_authorized_keys:
 - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDtyBWCaDz+Kg7ouHI9O5KW9CM8AX+gbUrQQXSl6bgSTsG7HuF2wBOUmL1NdXVFUfPppbnx53safsMLiydDAjlmiQWIMaZwXo7ZFPfQjBlfPS9Cn9elx/yBCQxB+EzuaSuU4jjNvu6OnONM6aSr7kCuhxomVboKhlWSPtVkhDJSYw+p2AZgppwCjKU/C3Md5Uc9PRQpLg1DGAktBFU8N4hDq6dMgij5DOMg5hf+j9If89eAilV7RYCCB/p/DZSScXCatPF9F2xMwQ4EUf/iLxXFaBvmjZcl/hymQ17P2BPQxin9ZV7iYsopz1oqzNXUBxaVHO1Y2pr3anJsc30qwEFn ubuntu@acc3-flask

runcmd:
 - export OS_AUTH_URL=https://uppmax.cloud.snic.se:5000/v3

 - export OS_PROJECT_ID=2344cddf33a1412b846290a9fb90b762
 - export OS_PROJECT_NAME="SNIC 2018/10-30"
 - export OS_USER_DOMAIN_NAME="snic"
 - export OS_PROJECT_DOMAIN_NAME="snic"
 - if [ -z "$OS_USER_DOMAIN_NAME" ]; then unset OS_USER_DOMAIN_NAME; fi

 - unset OS_TENANT_ID
 - unset OS_TENANT_NAME

 - export OS_USERNAME="s11856"

 - export OS_PASSWORD="acc3project"

 - export OS_REGION_NAME="UPPMAX"
 - if [ -z "$OS_REGION_NAME" ]; then unset OS_REGION_NAME; fi

 - export OS_INTERFACE=public
 - export OS_IDENTITY_API_VERSION=3
 - echo "export PATH=$PATH:/usr/games" >> /home/ubuntu/.bashrc
 - source /home/ubuntu/.bashrc
 - source /home/ubuntu/bihi-openrc.sh
 - ansibleIPhost=$(openstack server list --name acc3-ansible -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-ansible"}')
 - masterIPhost=$(openstack server list --name acc3-master -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-master"}')
 - workerIPhost=$(openstack server list --name acc3-worker -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-worker"}')
 - echo $ansibleIPhost | sudo tee -a /etc/hosts
 - echo $masterIPhost | sudo tee -a /etc/hosts
 - echo $workerIPhost | sudo tee -a /etc/hosts
