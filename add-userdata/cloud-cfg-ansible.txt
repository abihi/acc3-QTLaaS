#cloud-config

apt_update: true
apt_upgrade: true
packages:
 - build-essential
byobu_default: system

ssh_authorized_keys:
 - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDtyBWCaDz+Kg7ouHI9O5KW9CM8AX+gbUrQQXSl6bgSTsG7HuF2wBOUmL1NdXVFUfPppbnx53safsMLiydDAjlmiQWIMaZwXo7ZFPfQjBlfPS9Cn9elx/yBCQxB+EzuaSuU4jjNvu6OnONM6aSr7kCuhxomVboKhlWSPtVkhDJSYw+p2AZgppwCjKU/C3Md5Uc9PRQpLg1DGAktBFU8N4hDq6dMgij5DOMg5hf+j9If89eAilV7RYCCB/p/DZSScXCatPF9F2xMwQ4EUf/iLxXFaBvmjZcl/hymQ17P2BPQxin9ZV7iYsopz1oqzNXUBxaVHO1Y2pr3anJsc30qwEFn ubuntu@acc3-flask

runcmd:
 - export OS_AUTH_URL=https://uppmax.cloud.snic.se:5000/v3

 - export OS_PROJECT_ID=2344cddf33a1412b846290a9fb90b762
 - export OS_PROJECT_NAME="SNIC 2018/10-30"
 - export OS_USER_DOMAIN_NAME="snic"
 - export OS_PROJECT_DOMAIN_NAME="snic"
 - if [ -z "$OS_USER_DOMAIN_NAME" ]; then unset OS_USER_DOMAIN_NAME; fi

 - unset OS_TENANT_ID
 - unset OS_TENANT_NAME

 - export OS_USERNAME="s11856"

 - export OS_PASSWORD="acc3project"

 - export OS_REGION_NAME="UPPMAX"
 - if [ -z "$OS_REGION_NAME" ]; then unset OS_REGION_NAME; fi

 - export OS_INTERFACE=public
 - export OS_IDENTITY_API_VERSION=3
 - echo "export PATH=$PATH:/usr/games" >> /home/ubuntu/.bashrc
 - source /home/ubuntu/.bashrc
 - source /home/ubuntu/bihi-openrc.sh
 - ansibleIPhost=$(openstack server list --name acc3-ansible -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-ansible"}')
 - masterIPhost=$(openstack server list --name acc3-master -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-master"}')
 - workerIPhost=$(openstack server list --name acc3-worker -c Networks -f value | awk '{ split($5, v, "=");split(v[2],x,","); print x[1], "acc3-worker"}')
 - echo $ansibleIPhost | sudo tee -a /etc/hosts
 - echo $masterIPhost | sudo tee -a /etc/hosts
 - echo $workerIPhost | sudo tee -a /etc/hosts
